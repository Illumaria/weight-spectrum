[RU](https://github.com/Illumaria/weight-spectrum/blob/master/docs/solution.md) | [EN](https://github.com/Illumaria/weight-spectrum/blob/master/docs/solution.en.md)

# Решение

Для начала продемонстрируем решение задачи в лоб на простейшем примере, а заодно пронаблюдаем способы упрощения вычислений.

Пусть задан следующий набор векторов:
```
vectors = [[0, 0, 1],
           [1, 0, 0],
           [1, 0, 1]]
```

Если *K* — количество векторов, то для трёх заданных векторов возможно ![powK](https://latex.codecogs.com/png.latex?%5Cinline%20%5Clarge%202%5E%7BK%7D) их линейных комбинаций и, соответственно, различных комбинаций значений ![beta_i](https://latex.codecogs.com/png.latex?%5Cinline%20%5Clarge%20%5Cbeta_%7Bi%7D) (далее будем обозначать коэффициенты символом *b*):
```
b = [[0, 0, 0],
     [0, 0, 1],
     [0, 1, 0],
     [0, 1, 1],
     [1, 0, 0],
     [1, 0, 1],
     [1, 1, 0],
     [1, 1, 1]]
```

Условимся, что под операцией сложения векторов автоматичечки подразумевается сложение по модулю 2. Тогда все возможные комбинации можно записать в виде:
```
combinations = [[0*[1, 0, 1] + 0*[1, 0, 0] + 0*[0, 0, 1]], = [[0, 0, 0],
                [0*[1, 0, 1] + 0*[1, 0, 0] + 1*[0, 0, 1]], =  [0, 0, 1],
                [0*[1, 0, 1] + 1*[1, 0, 0] + 0*[0, 0, 1]], =  [1, 0, 0],
                [0*[1, 0, 1] + 1*[1, 0, 0] + 1*[0, 0, 1]], =  [1, 0, 1],
                [1*[1, 0, 1] + 0*[1, 0, 0] + 0*[0, 0, 1]], =  [1, 0, 1],
                [1*[1, 0, 1] + 0*[1, 0, 0] + 1*[0, 0, 1]], =  [1, 0, 0],
                [1*[1, 0, 1] + 1*[1, 0, 0] + 0*[0, 0, 1]], =  [0, 0, 1],
                [1*[1, 0, 1] + 1*[1, 0, 0] + 1*[0, 0, 1]]] =  [0, 0, 0]]
```

В результате получилось 8 векторов длиной 3. Вес каждого вектора будет равен сумме единиц в его записи:
```
weights = [[0],
           [1],
           [1],
           [2],
           [2],
           [1],
           [1],
           [0]]
```

Наконец, для получения спектра необходимо вычислить число вхождений каждого веса:
```
spectrum =
0    2
1    4
2    2
3    0
```

А теперь обратим внимание на два следующих момента. Во-первых, как можно заметить, второй разряд каждого вектора из исходного набора равен нулю. Соответственно, второй разряд любой линейной комбинации этих векторов (результат `combinations`) также будет равен нулю и никакого вклада в спектр не внесёт. Во-вторых, третий вектор из набора является линейной комбинацией первых двух. Это приводит к тому, что любая комбинация этого вектора и линейно независимых векторов набора не будет уникальной — по факту, наличие такого вектора приводит к удвоению весов, полученных без него. Исключение нулевых столбцов и линейно зависимых векторов приводит к получению *базиса* подпространства и позволяет существенно сократить количество вычислений при нахождении спектра.

Частным случаем описанного выше является получение в результате таких преобразований единичной матрицы, вычисление спектра которой может быть выполнено ещё более быстро. Приведённый выше пример как раз является таким случаем. Давайте исключим из исходного набора нулевой столбец и линейно зависимый вектор и пронаблюдаем за результатом:

| vectors | b    | combinations | weights | spectrum |
|:-------:|:----:|:------------:|:-------:|:--------:|
| 0, 1    | 0, 0 | 0, 0         | 0       | 0....1 (×2)   |
| 1, 0    | 0, 1 | 0, 1         | 1       | 1....2 (×2)   |
|         | 1, 0 | 1, 0         | 1       | 2....1 (×2)   |
|         | 1, 1 | 1, 1         | 2       | 3....0 (×2)   |

Как можно видеть, результаты соответствуют таковым при прямом вычислении. Но получить их можно и без нахождения линейных комбинаций — путём вычисления [биномиальных коэффициентов](https://ru.wikipedia.org/wiki/%D0%91%D0%B8%D0%BD%D0%BE%D0%BC%D0%B8%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9_%D0%BA%D0%BE%D1%8D%D1%84%D1%84%D0%B8%D1%86%D0%B8%D0%B5%D0%BD%D1%82), где текущий вес (коэффициент) может быть выражен через предыдущий как ![weight](https://latex.codecogs.com/png.latex?%5Cinline%20weight_%7Bi%7D%20%3D%20weight_%7Bi-1%7D%28rank&plus;1-i%29/i) (согласно ![coef](https://latex.codecogs.com/png.latex?%5Cinline%20C_%7Bn%7D%5E%7Bk%7D%20%3D%20%28n-k%29/k*C_%7Bn%7D%5E%7Bk-1%7D)), где *rank* — ранг полученного после преобразований базиса (в текущем примере равен 2), а прибавление единицы в скобках обеспечивает корректное количество весов в спектре (равное длине исходных векторов, увеличенной на единицу):
```
weight[0] = 1,
weight[1] = weight[0] * (3 - 1) / 1 = 2,
weight[2] = weight[1] * (3 - 2) / 2 = 1,
weight[3] = weight[2] * (3 - 3) / 3 = 0
```

Все полученные веса по-прежнему необходимо умножить на 2 столько раз, сколько линейно зависимых векторов было удалено при получении базиса.

После нахождения базиса и его размера (нового количества векторов) решение соответствует представленному в [этой статье](https://habr.com/ru/company/wolfram/blog/336350/).
